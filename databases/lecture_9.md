# Семантическая модель (ER-model)
**ER - Entity-Relationship**

## Семантические модели данных 

Реляцонная модель хороша, но имеет ограничения:
- Реляционная модель не обеспечивает достаточных средств для представления смысла данных
- Реляционная модель не предоставляет какие-либо формальные средства для представления внутренних зависимостей 

### Назначение
Основным назначением семантических моделей данных является обеспечение возможности выражения семантики данных. Эти модели используют на первой стадии проектирования базы данных:
- Сначала строится коцепт-схема базы данных в терминах семантической модели
- После ее вручную преобразуют к реляционной схеме

### Преимущества
- Наглядность устройства базы данных, во-первых, помогает легче вникать в работу продукта, во-вторых, помогает избежать ошибок в ее проектировании
- При семантическом моделировании производится документация, которая существенно облегчает работу с этой базой данных
- Моделированние базы данных осуществляется через графические диаграммы
  
Т.е. преимущества семантической модели данных это **простота и наглядность**

### Основные понятия 
- **Сущность** - объект (реальный или нет), информация о котором должна храниться и быть доступной. 
	  Графически представляется в виде **прямоугольника**, содержащего имя сущности - имя типа
- **Связь** - графически изображаемая ассоциация, показывающая связь между двумя сущностями(типами). В любой связи выделяют два конца с указанием на каждом из них:
	  - имя конца связи
	  - степень конца связи
	  - обязательность связи
	  Графически представляется в виде **линий**, соединяющих две сущности
	  - 3-точеный вход ==> для этой сущности в связи могут (или должны) использоваться много экземпляров этого типа 
	  - 1-точечный вход ==> для этой сущности в связи может (или должен) использоваться лишь один экземляр этого типа
	![[images/Pasted image 20230224142947.png]]
	
	- "МУЖЧИНА" может быть единственным отцом 
	- "МУЖЧИНА" может быть одним из нескольких сыновей
	
- **Атрибут** - поля сущности. Используются для спецификации сущности.

### Атрибуты в разных моделях данных
В реляционной модели данных атрибут определяется как упорядоченная пара: `<attribute_name, domain_name>`, а в семантичекой модели указание домена атрибута не является обязательным   

### Уникальные идентификаторы типов сущности
**При определении сущности нобходимо гарантировать, что каждый экземпляр типа был уникальным - отличным от любого другого экземпляра того же типа**

В роли уникального идентификатора может выступать:
- Атрибут (или их комбинация) (*первичный ключ* или *составной первичный ключ*)
- Связь (или их комбинация)
- Комбинация атрибутов и связей

### Наследование
Сущност при проектировании реляционной базы данных может быть разделена на несколько взаимно-исключающих подтипа, каждый из которых включает в себя общие атрибуты или связи. Эти атрибуты и связи явно определяются единожды на более высоком уровне - в родительском **супертипе**. В подтипах могут определяться собсвенные атрибуты или связи. 

Особенности наследования в ER-модели определяются следующими правилами:
- Если у типа сущности A имеются подсущности $B_1,\dots,B_n$ 
	- (Включение) Любой экземпляр сущности $B_1,\dots,B_n$ является экземпляром сущности A
	- (Отсутсвие экземпляра супертипа) Если a экземпляр сущности A, то a является экземпляром некоторого подтипа $B_i$, где $i=1,2,\dots,n$  
	- (Разъединенность подтипов) Ни для каких 2 подтипов не существует экземпляра, тип которого совпадает одновременно с этими подтипами
![[images/Pasted image 20230224163103.png]]

### Взаимно-исключающие связи
Взаимно исключающие связи обеспечивают существование единственного экземпляра  со связью из заданного набора связей. 
![[images/Pasted image 20230224163558.png]]

В данном случае для каждого экземпляра типа "САМОЛЕТ" может существовать лишь одно из связей с типами "ПИЛОТ" и "АРП", поскольку либо самолет находится в распоряжении пилота, либо он сейчас проходит ремонтые работы.

**Диаграмма с взаимно-исключающими связями может быть преобразованна к диаграмме без взаимно-исключающих связей через ввод дополнительных подтипов**

![[images/Pasted image 20230224163844.png]]

### Перестроение ER-модели в реляционную модель
После того, как устройство базы данных было постороенно в виде ER-модели, ее необходимо преобразовать в реляционную модель.

> Простым типом сущности называется тип сущности, который не является подтипом либо супертипом

Каждый простой тип сущности превращается в таблицу:
- Имя сущности становится именем таблицы
- Каждый атрибут становится столбцом таблицы
- Экземпляр типа становится строкой таблицы
- Уникальный идентификатор сущности становится первичным ключом таблицы
- Связи "многие к одномму" и "один к одному" становятся внешними ключами, т.е. образуется копия уникального идентификатора сущности на конце связи "один", и соотв-ие столбцы составляют внешний ключ таблицы, соотв-ей типу на конце связи "многие" 
- Если между двуми типами имеется связь "один к одному", то соотв-ий внешний ключ по желанию проектировщика может быть объявлен в любой из таблиц
- Для поддержки связи "многие ко многим" между этими типами создается дополнительная таблица с двумя столбцами, в каждом из столбце этой таблицы содержатся уникальные идентификаторы каждого из типов рассматриваемой связи

#### Поддержка супертипов и подтипов
- Создается единная таблица для всех подтипов. Столбцы таблицы, соотв-ие каждому атрибуту и их связям. Дополнительно, приписывается специальный столбец - код подтипа, тогда для каждой строки таблицы значение этого столбца определяет конкретный подтип, которому соотв-ет строка. 
	- [\+] Простой доступ к экземплярам супертипа
	- [\+] Средняя сложность доступа к экземплярам подтипов
	- [\+] Умеренное число таблиц
	- [\-] Приложения, работающие с одной таблицей супертипа, должны правильно обрабатывать разные наборы столбцов с разными ограничениями целостности
	- [\-] Общая для всех подтипов таблица потенциально может стать узким местом при многопользовательском доступе по причине возможности блокировки таблицы целиком 
	- [\-] Потенциально в общей таблице будет содержаться много неопредленных значений, что может привести к непроизводительному расходу внешней памяти
- Создание таблицы для каждого из подтипов. Тогда для получения всех кортежей супертипа нужно объединить прокеции таблиц подтипов, на заголовок таблицы супертипа (из всех таблиц подтипов выбираются столбцы общие со столбцами супертипа)
	- [\+] Каждому подтипу соотв-ет отдельная таблица, что облегчает работу с подтипами
	- [\+] Упрощение логики приложения, каждая программа работает только с нужной таблицей
	- [\-] Большое число таблиц
	- [\-] ==Работа с экземплярами супертипа== на основе предствавления, объединяющего таблицы супертипа, может оказаться неэффективной
	- [\-] Множество экземпляров супертипа является объединением множеств экземпляров подтипов, не все РСУБД могут обеспечить выполнение операций модификации экземпляров супертипа

#### Поддержка взаимно-исключающих связей
- Определение таблицы с одном столбцом для представления всех взаимно-исключающих связей, т.е. общее хранение внешних ключей
	- [\+] В таблице, соотв-ей сущности с взаимо-искл. связями появляется всего два дополнительных столбца
	- [\-] Усложнение выполнения операции соединения
- Определние таблицы, где каждой взаимно-исключащей связи соотв-ет отдельный столбец, т.е. раздельное хранение внешних ключей
	- [\+] Явное представление соединений
	- [\-] Требуется иметь столько столбцов, сколько имеется ==альтернативных связей==. Кроме того, в каждом из таких столбцов может содержаться много неопределнных значений, хранение которых приводит к излишнему расходу внешней памяти

# Вопросы

1. Что такое альтернативные связи
2.  Разве супертипы могут иметь экземпляры 